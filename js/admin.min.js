!function(i){i.fn.gravityFormsPayFeedEditor=function(){return this.each(function(){var e=i(this);if(!e.data("gf-pay-feed-editor")){var n=new function(e){var n=this,t=i(e),o={};o.feed=t.find("#gf_ideal_feed"),o.gravityForm=t.find("#gf_ideal_gravity_form"),o.formId=t.find("#_pronamic_pay_gf_form_id"),o.configId=t.find("#gf_ideal_config_id"),o.delayPostCreationItem=t.find("#gf_ideal_delay_post_creation_item"),o.conditionEnabled=t.find("#gf_ideal_condition_enabled"),o.conditionConfig=t.find("#gf_ideal_condition_config"),o.conditionFieldId=t.find("#gf_ideal_condition_field_id"),o.conditionOperator=t.find("#gf_ideal_condition_operator"),o.conditionValue=t.find("#gf_ideal_condition_value"),o.conditionMessage=t.find("#gf_ideal_condition_message"),o.confirmationSelectFields=t.find(".gf_ideal_confirmation_select"),o.userRoleFieldId=t.find("#gf_ideal_user_role_field_id"),o.delayNotifications=t.find("#gf_ideal_delay_notifications"),o.fieldSelectFields=t.find("select.field-select"),o.subscriptionAmountType=t.find('input[name="_pronamic_pay_gf_subscription_amount_type"]'),o.subscriptionAmountField=t.find("#pronamic_pay_gf_subscription_amount_field"),o.subscriptionIntervalType=t.find('input[name="_pronamic_pay_gf_subscription_interval_type"]'),o.subscriptionInterval=t.find("#pronamic_pay_gf_subscription_interval"),o.subscriptionIntervalPeriod=t.find("#pronamic_pay_gf_subscription_interval_period"),o.subscriptionIntervalField=t.find("#pronamic_pay_gf_subscription_interval_field"),o.subscriptionFrequencyType=t.find('input[name="_pronamic_pay_gf_subscription_frequency_type"]'),o.subscriptionFrequency=t.find("#pronamic_pay_gf_subscription_frequency"),o.subscriptionFrequencyField=t.find("#pronamic_pay_gf_subscription_frequency_field");var a=i.parseJSON(o.feed.val()),d=i.parseJSON(o.gravityForm.val());this.updateDelayPostCreationItem=function(){var i=!1;d&&n.getFieldsByType(["post_title","post_content","post_excerpt","post_category","post_custom_field","post_image","post_tag"]).length>0&&(i=!0),o.delayPostCreationItem.toggle(i)},this.updateConfirmationFields=function(){o.confirmationSelectFields.empty(),i("<option>").appendTo(o.confirmationSelectFields),d&&i.each(o.confirmationSelectFields,function(e,n){var t=i(n).attr("data-pronamic-link-name"),o=!1;i.each(d.confirmations,function(e,d){o=!1,"object"==typeof a.links&&(o=a.links[t].confirmation_id===d.id),i("<option>").attr("value",d.id).text(d.name).prop("selected",o).appendTo(n)})})},this.toggleConditionConfig=function(){1>=o.conditionFieldId.find("option").length?(o.conditionConfig.fadeOut("fast"),o.conditionEnabled.before(o.conditionConfig),o.conditionMessage.show(),o.conditionEnabled.val(0)):(o.conditionConfig.fadeIn("fast"),o.conditionEnabled.after(o.conditionConfig),o.conditionMessage.hide(),o.conditionEnabled.val(1))},this.updateConditionFields=function(){o.conditionFieldId.empty(),i("<option>").appendTo(o.conditionFieldId),d&&(i.each(d.fields,function(e,n){var t=n.inputType?n.inputType:n.type;if(i.inArray(t,["checkbox","radio","select"])>=0){var d=n.adminLabel?n.adminLabel:n.label;i("<option>").attr("value",n.id).text(d).prop("selected",1==a.conditionEnabled&&a.conditionFieldId==n.id).appendTo(o.conditionFieldId)}}),o.conditionOperator.val(a.conditionOperator))},this.updateConditionValues=function(){var e=o.conditionFieldId.val(),t=n.getFieldById(e);o.conditionValue.empty(),i("<option>").appendTo(o.conditionValue),t?(o.conditionOperator.removeProp("disabled"),o.conditionValue.removeProp("disabled")):(o.conditionOperator.prop("disabled",!0),o.conditionValue.prop("disabled",!0)),t&&t.choices&&(i.each(t.choices,function(e,n){var t=n.value?n.value:n.text;i("<option>").attr("value",t).text(n.text).appendTo(o.conditionValue)}),o.conditionValue.val(a.conditionValue))},this.getFieldById=function(i){if(d)for(var e=0;e<d.fields.length;e++)if(d.fields[e].id==i)return d.fields[e];return null},this.getFieldsByType=function(e){var n=[];if(d)for(var t=0;t<d.fields.length;t++)i.inArray(d.fields[t].type,e)>=0&&n.push(d.fields[t]);return n},this.getInputs=function(){var e=[];return d&&i.each(d.fields,function(n,t){t.inputs?i.each(t.inputs,function(i,n){e.push(n)}):t.displayOnly||e.push(t)}),e},this.changeForm=function(){jQuery.get(ajaxurl,{action:"gf_get_form_data",formId:o.formId.val()},function(i){i.success&&(d=i.data,n.updateFields())})},this.updateUserRoleFields=function(){o.userRoleFieldId.empty(),i("<option>").appendTo(o.userRoleFieldId),d&&i.each(d.fields,function(e,n){var t=n.adminLabel?n.adminLabel:n.label;i("<option>").attr("value",n.id).text(t).prop("selected",a.userRoleFieldId==n.id).appendTo(o.userRoleFieldId)})},this.updateConfigFields=function(){var i=o.configId.find("option:selected").attr("data-ideal-method");t.find(".extra-settings").hide(),t.find(".method-"+i).show()},this.updateNotifications=function(){o.delayNotifications.empty(),d&&i.each(d.notifications,function(e,n){if("form_submission"===n.event){var t=i("<li>").appendTo(o.delayNotifications),d="pronamic-pay-gf-notification-"+n.id;i('<input type="checkbox" name="_pronamic_pay_gf_delay_notification_ids[]">').attr("id",d).val(n.id).prop("checked",i.inArray(n.id,a.delayNotificationIds)>=0).appendTo(t),t.append(" "),i("<label>").attr("for",d).text(n.name).appendTo(t)}})},this.updateSubscriptionFields=function(){if(d){o.subscriptionAmountField.empty(),o.subscriptionIntervalField.empty(),o.subscriptionFrequencyField.empty();var c=[];d&&i.each(d.fields,function(i,e){"product"===e.type&&c.push(e)}),t=i(o.subscriptionAmountField),i("<option>").appendTo(t),i.each(c,function(e,n){var o=n.adminLabel?n.adminLabel:n.label;i("<option>").attr("value",n.id).text(o).prop("selected",a.subscriptionAmountField==n.id).appendTo(t)}),o.subscriptionAmountType.on("change",function(){var n=o.subscriptionAmountType.filter(":checked").val();i(e).find(".pronamic-pay-gf-subscription-amount-settings").hide();var t=i(e).find(".pronamic-pay-gf-subscription-amount-settings.amount-"+n);t.length>0&&t.show()}),o.subscriptionAmountType.trigger("change"),t=i(o.subscriptionIntervalField),i("<option>").appendTo(t),i.each(n.getInputs(),function(e,n){var o=n.adminLabel?n.adminLabel:n.label;i("<option>").attr("value",n.id).text(o).prop("selected",a.subscriptionIntervalField==n.id).appendTo(t)}),o.subscriptionIntervalType.on("change",function(){var n=o.subscriptionIntervalType.filter(":checked").val();i(e).find(".pronamic-pay-gf-subscription-interval-settings").hide();var t=i(e).find(".pronamic-pay-gf-subscription-interval-settings.interval-"+n);t.length>0&&t.show()}),o.subscriptionIntervalType.trigger("change"),t=i(o.subscriptionFrequencyField),i("<option>").appendTo(t),i.each(n.getInputs(),function(e,n){var o=n.adminLabel?n.adminLabel:n.label;i("<option>").attr("value",n.id).text(o).prop("selected",a.subscriptionFrequencyField==n.id).appendTo(t)}),o.subscriptionFrequencyType.on("change",function(){var n=o.subscriptionFrequencyType.filter(":checked").val();i(e).find(".pronamic-pay-gf-subscription-frequency-settings").hide();var t=i(e).find(".pronamic-pay-gf-subscription-frequency-settings.frequency-"+n);t.length>0&&t.show()}),o.subscriptionFrequencyType.trigger("change")}},this.updateSelectFields=function(){d&&(o.fieldSelectFields.empty(),o.fieldSelectFields.each(function(e,o){var d=(t=i(o)).data("gateway-field-name");i("<option>").appendTo(t),i.each(n.getInputs(),function(e,n){var o=n.adminLabel?n.adminLabel:n.label;i("<option>").attr("value",n.id).text(o).prop("selected",a.fields[d]==n.id).appendTo(t)})}))},this.updateFields=function(){n.updateConfigFields(),n.updateDelayPostCreationItem(),n.updateConfirmationFields(),n.updateConditionFields(),n.toggleConditionConfig(),n.updateConditionValues(),n.updateUserRoleFields(),n.updateSubscriptionFields(),n.updateSelectFields(),n.updateNotifications()},n.updateFields(),o.formId.change(n.changeForm),o.configId.change(n.updateConfigFields),o.conditionFieldId.change(n.updateConditionValues)}(this);e.data("gf-pay-feed-editor",n)}})},i(document).ready(function(){i(".gforms_edit_form .ideal-edit-link").click(function(i){i.stopPropagation()}),i("#gf-pay-feed-editor").gravityFormsPayFeedEditor(),"undefined"!=typeof gform&&"undefined"!=typeof form&&gform.addAction("gform_load_field_choices",function(e){var n=e.shift();if(n){var t="pronamic_pay_payment_method_selector"===n.type;i('label[for="field_choice_values_enabled"]').parent("div").toggle(!t),t&&i.each(n.choices,function(e,n){if(n.builtin){var t=i(".field-choice-input.field-choice-value").eq(e);t.attr("disabled","disabled"),t.parent("li").find(".gf_delete_field_choice").remove()}})}}),i(document).on("gform_load_field_settings",function(e,n){i("#pronamic_pay_config_field").val(n.pronamicPayConfigId)})})}(jQuery);
//# sourceMappingURL=admin.min.js.map