!function(c){var n=function(t){var o=this,a=c(t),d={};d.feed=a.find("#gf_ideal_feed"),d.gravityForm=a.find("#gf_ideal_gravity_form"),d.formId=a.find("#_pronamic_pay_gf_form_id"),d.configId=a.find("#gf_ideal_config_id"),d.delayPostCreationItem=a.find("#gf_ideal_delay_post_creation_item"),d.conditionEnabled=a.find("#gf_ideal_condition_enabled"),d.conditionConfig=a.find("#gf_ideal_condition_config"),d.conditionFieldId=a.find("#gf_ideal_condition_field_id"),d.conditionOperator=a.find("#gf_ideal_condition_operator"),d.conditionValue=a.find("#gf_ideal_condition_value"),d.conditionMessage=a.find("#gf_ideal_condition_message"),d.confirmationSelectFields=a.find(".gf_ideal_confirmation_select"),d.userRoleFieldId=a.find("#gf_ideal_user_role_field_id"),d.delayNotifications=a.find("#gf_ideal_delay_notifications"),d.fieldSelectFields=a.find("select.field-select"),d.subscriptionAmountType=a.find('input[name="_pronamic_pay_gf_subscription_amount_type"]'),d.subscriptionAmountField=a.find("#pronamic_pay_gf_subscription_amount_field"),d.subscriptionIntervalType=a.find('input[name="_pronamic_pay_gf_subscription_interval_type"]'),d.subscriptionInterval=a.find("#pronamic_pay_gf_subscription_interval"),d.subscriptionIntervalPeriod=a.find("#pronamic_pay_gf_subscription_interval_period"),d.subscriptionIntervalDateType=a.find('input[name="_pronamic_pay_gf_subscription_interval_date_type"]'),d.subscriptionIntervalDate=a.find("#pronamic_pay_gf_subscription_interval_date"),d.subscriptionIntervalDateDay=a.find("#pronamic_pay_gf_subscription_interval_date_day"),d.subscriptionIntervalDateMonth=a.find("#pronamic_pay_gf_subscription_interval_date_month"),d.subscriptionIntervalField=a.find("#pronamic_pay_gf_subscription_interval_field"),d.subscriptionFrequencyType=a.find('input[name="_pronamic_pay_gf_subscription_frequency_type"]'),d.subscriptionFrequency=a.find("#pronamic_pay_gf_subscription_frequency"),d.subscriptionFrequencyField=a.find("#pronamic_pay_gf_subscription_frequency_field");var r=c.parseJSON(d.feed.val()),s=c.parseJSON(d.gravityForm.val());this.updateDelayPostCreationItem=function(){var i=!1;s&&(0<o.getFieldsByType(["post_title","post_content","post_excerpt","post_category","post_custom_field","post_image","post_tag"]).length&&(i=!0));d.delayPostCreationItem.toggle(i)},this.updateConfirmationFields=function(){d.confirmationSelectFields.empty(),c("<option>").appendTo(d.confirmationSelectFields),s&&c.each(d.confirmationSelectFields,function(i,t){var o=c(t).attr("data-pronamic-link-name");c.each(s.confirmations,function(i,e){var n=!1;"object"==typeof r.links&&(n=r.links[o].confirmation_id===e.id),c("<option>").attr("value",e.id).text(e.name).prop("selected",n).appendTo(t)})})},this.toggleConditionConfig=function(){d.conditionFieldId.find("option").length<=1?(d.conditionConfig.fadeOut("fast"),d.conditionEnabled.before(d.conditionConfig),d.conditionMessage.show(),d.conditionEnabled.val(0)):(d.conditionConfig.fadeIn("fast"),d.conditionEnabled.after(d.conditionConfig),d.conditionMessage.hide(),d.conditionEnabled.val(1))},this.updateConditionFields=function(){d.conditionFieldId.empty(),c("<option>").appendTo(d.conditionFieldId),s&&(c.each(s.fields,function(i,e){var n=e.inputType?e.inputType:e.type;if(0<=c.inArray(n,["checkbox","radio","select"])){var t=e.adminLabel?e.adminLabel:e.label;c("<option>").attr("value",e.id).text(t).prop("selected",1==r.conditionEnabled&&r.conditionFieldId==e.id).appendTo(d.conditionFieldId)}}),d.conditionOperator.val(r.conditionOperator))},this.updateConditionValues=function(){var i=d.conditionFieldId.val(),e=o.getFieldById(i);d.conditionValue.empty(),c("<option>").appendTo(d.conditionValue),e?(d.conditionOperator.removeProp("disabled"),d.conditionValue.removeProp("disabled")):(d.conditionOperator.prop("disabled",!0),d.conditionValue.prop("disabled",!0)),e&&e.choices&&(c.each(e.choices,function(i,e){var n=e.value?e.value:e.text;c("<option>").attr("value",n).text(e.text).appendTo(d.conditionValue)}),d.conditionValue.val(r.conditionValue))},this.getFieldById=function(i){if(s)for(var e=0;e<s.fields.length;e++)if(s.fields[e].id==i)return s.fields[e];return null},this.getFieldsByType=function(i){var e=[];if(s)for(var n=0;n<s.fields.length;n++)0<=c.inArray(s.fields[n].type,i)&&e.push(s.fields[n]);return e},this.getInputs=function(){var n=[];return s&&c.each(s.fields,function(i,e){e.inputs?c.each(e.inputs,function(i,e){n.push(e)}):e.displayOnly||n.push(e)}),n},this.changeForm=function(){jQuery.get(ajaxurl,{action:"gf_get_form_data",formId:d.formId.val()},function(i){i.success&&(s=i.data,o.updateFields())})},this.updateUserRoleFields=function(){d.userRoleFieldId.empty(),c("<option>").appendTo(d.userRoleFieldId),s&&c.each(s.fields,function(i,e){var n=e.adminLabel?e.adminLabel:e.label;c("<option>").attr("value",e.id).text(n).prop("selected",r.userRoleFieldId==e.id).appendTo(d.userRoleFieldId)})},this.updateConfigFields=function(){var i=d.configId.find("option:selected").attr("data-ideal-method");a.find(".extra-settings").hide(),a.find(".method-"+i).show()},this.updateNotifications=function(){d.delayNotifications.empty(),s&&c.each(s.notifications,function(i,e){if("form_submission"===e.event){var n=c("<li>").appendTo(d.delayNotifications),t="pronamic-pay-gf-notification-"+e.id;c('<input type="checkbox" name="_pronamic_pay_gf_delay_notification_ids[]">').attr("id",t).val(e.id).prop("checked",0<=c.inArray(e.id,r.delayNotificationIds)).appendTo(n),n.append(" "),c("<label>").attr("for",t).text(e.name).appendTo(n)}})},this.updateSubscriptionFields=function(){if(s){d.subscriptionAmountField.empty(),d.subscriptionIntervalField.empty(),d.subscriptionFrequencyField.empty();var n=[];s&&c.each(s.fields,function(i,e){"product"===e.type&&n.push(e)}),a=c(d.subscriptionAmountField),c("<option>").appendTo(a),c.each(n,function(i,e){var n=e.adminLabel?e.adminLabel:e.label;c("<option>").attr("value",e.id).text(n).prop("selected",r.subscriptionAmountField==e.id).appendTo(a)}),d.subscriptionAmountType.on("change",function(){var i=d.subscriptionAmountType.filter(":checked").val();if(c(t).find(".pronamic-pay-gf-subscription-amount-settings").hide(),""===i)d.subscriptionAmountType.parents("tr").siblings().hide();else{d.subscriptionAmountType.parents("tr").siblings().show();var e=d.subscriptionAmountType.parents("table").find("tr");e.removeClass("even"),e.filter(":visible:even").addClass("even")}var n=c(t).find(".pronamic-pay-gf-subscription-amount-settings.amount-"+i);0<n.length&&n.show()}),d.subscriptionAmountType.trigger("change"),a=c(d.subscriptionIntervalField),c("<option>").appendTo(a),c.each(o.getInputs(),function(i,e){var n=e.adminLabel?e.adminLabel:e.label;c("<option>").attr("value",e.id).text(n).prop("selected",r.subscriptionIntervalField==e.id).appendTo(a)}),d.subscriptionIntervalType.on("change",function(){var i=d.subscriptionIntervalType.filter(":checked").val();c(t).find(".pronamic-pay-gf-subscription-interval-settings").hide();var e=c(t).find(".pronamic-pay-gf-subscription-interval-settings.interval-"+i);"fixed"!==i&&(d.subscriptionIntervalPeriod.val("D"),d.subscriptionIntervalPeriod.trigger("change")),0<e.length&&e.show()}),d.subscriptionIntervalDateType.on("change",function(){var i=d.subscriptionIntervalDateType.filter(":checked").val();c(t).find(".pronamic-pay-gf-subscription-interval-date-settings").hide();var e=c(t).find(".pronamic-pay-gf-subscription-interval-date-settings.interval-date-"+i);0<e.length&&e.show()}),d.subscriptionIntervalPeriod.on("change",function(){var i=d.subscriptionIntervalPeriod.val();switch(c(t).find(".pronamic-pay-gf-subscription-interval-date-sync-settings").hide(),c(t).find(".pronamic-pay-gf-subscription-interval-date-sync-settings.interval-"+i).show(),i){case"D":d.subscriptionIntervalDateType.filter('[value="payment_date"]').prop("checked",!0),d.subscriptionIntervalDateType.attr("disabled","disabled"),d.subscriptionIntervalDate.val(""),d.subscriptionIntervalDateDay.val(""),d.subscriptionIntervalDateMonth.val("");break;case"W":d.subscriptionIntervalDateType.removeAttr("disabled"),d.subscriptionIntervalDate.val(""),d.subscriptionIntervalDateMonth.val("");break;case"M":d.subscriptionIntervalDateType.removeAttr("disabled"),d.subscriptionIntervalDateDay.val(""),d.subscriptionIntervalDateMonth.val("");break;case"Y":d.subscriptionIntervalDateType.removeAttr("disabled"),d.subscriptionIntervalDateDay.val("")}d.subscriptionIntervalDateType.trigger("change")}),c(t).find("select.pronamic-pay-gf-subscription-interval-date-sync-settings").on("change",function(){d.subscriptionIntervalDateType.filter('[value="sync"]').prop("checked",!0),d.subscriptionIntervalDateType.trigger("change")}),d.subscriptionIntervalType.trigger("change"),d.subscriptionIntervalPeriod.trigger("change"),a=c(d.subscriptionFrequencyField),c("<option>").appendTo(a),c.each(o.getInputs(),function(i,e){var n=e.adminLabel?e.adminLabel:e.label;c("<option>").attr("value",e.id).text(n).prop("selected",r.subscriptionFrequencyField==e.id).appendTo(a)}),d.subscriptionFrequencyType.on("change",function(){var i=d.subscriptionFrequencyType.filter(":checked").val();c(t).find(".pronamic-pay-gf-subscription-frequency-settings").hide();var e=c(t).find(".pronamic-pay-gf-subscription-frequency-settings.frequency-"+i);0<e.length&&e.show()}),d.subscriptionFrequencyType.trigger("change")}},this.updateSelectFields=function(){s&&(d.fieldSelectFields.empty(),d.fieldSelectFields.each(function(i,e){var t=(a=c(e)).data("gateway-field-name");c("<option>").appendTo(a),c.each(o.getInputs(),function(i,e){var n=e.adminLabel?e.adminLabel:e.label;c("<option>").attr("value",e.id).text(n).prop("selected",r.fields[t]==e.id).appendTo(a)})}))},this.updateFields=function(){o.updateConfigFields(),o.updateDelayPostCreationItem(),o.updateConfirmationFields(),o.updateConditionFields(),o.toggleConditionConfig(),o.updateConditionValues(),o.updateUserRoleFields(),o.updateSubscriptionFields(),o.updateSelectFields(),o.updateNotifications()},o.updateFields(),d.formId.change(o.changeForm),d.configId.change(o.updateConfigFields),d.conditionFieldId.change(o.updateConditionValues)};c.fn.gravityFormsPayFeedEditor=function(){return this.each(function(){var i=c(this);if(!i.data("gf-pay-feed-editor")){var e=new n(this);i.data("gf-pay-feed-editor",e)}})},c(document).ready(function(){c(".gforms_edit_form .ideal-edit-link").click(function(i){i.stopPropagation()}),c("#gf-pay-feed-editor").gravityFormsPayFeedEditor(),"undefined"!=typeof gform&&"undefined"!=typeof form&&(gform.addAction("gform_load_field_choices",function(i){var e=i.shift();if(e){var n="pronamic_pay_payment_method_selector"===e.type;c('label[for="field_choice_values_enabled"]').parent("div").toggle(!n),n&&c.each(e.choices,function(i,e){if(e.builtin){var n=c(".field-choice-input.field-choice-value").eq(i);n.attr("disabled","disabled"),n.parent("li").find(".gf_delete_field_choice").remove()}})}}),gform.addFilter("gform_has_conditional_logic_dependency",function(i,e){return"undefined"==typeof form?i:-1!==c.inArray(e.toString(),form.pronamic_pay_condition_field_ids)||i})),c(document).on("gform_load_field_settings",function(i,t){c.each({pronamic_pay_config_field:"pronamicPayConfigId",pronamic_pay_display_field:"pronamicPayDisplayMode"},function(i,e){var n=c("#"+i);0<n.find('option[value="'+t[e]+'"]').length?n.val(t[e]):SetFieldProperty(e,"")})})})}(jQuery);
//# sourceMappingURL=admin.min.js.map